#!/bin/bash

# Obtain the physical path to where the scripts are located, resolving all symbolic links.
RD=$(dirname $0) 
cd $RD
WD=$(pwd -P)

# Add executable privilege to all scripts
LIST='configure scriptCompile'
chmod u+x $LIST

# Check if existing $PATH already include $WD. Proceed only if $WD is not included in $PATH
# Parts of $PATH are separated by ":". 
N=$(echo $PATH | tr ":" "\n" | grep -c $WD)
if [ $N -ne 0 ]
then 
	echo 'System already configured'
	exit
fi

# Ask for permission to edit and source .bash_profile, if it already exists. Otherwise, create and source .bash_profile.
# Will only proceed if input is "y".
while [[ "$permission" != "y" ]] && [[ "$permission" != "n" ]]
do
	echo 'Allow editing ~/.bash_profile? (y/n)'
	read -p "> " permission
	if [[ "$permission" == "y" ]]
	then 
		echo 'Checking for existing profile...'
	elif [[ "$permission" == "n" ]]
	then
		echo 'Permission denied. Exiting script...'
		exit
	else
		echo 'Invalid input!'
	fi
done

# Check for existing .bash_profile. Append to existing file or create a new file.
if [ -e ~/.bash_profile ]
then
	echo 'Found existing profile. Saving a copy of current profile...'
	# Save original profile, add time stamp to file name.
	file=".bash_profile_archive_"$(date +%Y%m%d%H%M%S)
	# Following loop prevents the small possibility that file name already exists.
	while [ -e ./$file ]
	do
		sleep 1 
		# No need to acquire the date and time more than once per second, since the outcome will not change.
		file=".bash_profile_archive_"$(date +%Y%m%d%H%M%S)
	done
	cp ~/.bash_profile ~/$file
	echo 'Original profile saved as .bash_profile_archive_'$file'.'
else
	# Create a new .bash_profile
	echo '# User specific environment and startup programs' >> ~/.bash_profile
fi
# Add $WD to default path.
echo 'export PATH=$PATH:'$WD >> ~/.bash_profile
echo '~/.bash_profile configured.'
